锔 C贸mo lo hacemos (versi贸n t茅cnica para desarrolladores)

Nota: Esta documentaci贸n describe los principios t茅cnicos generales.
No se revelan algoritmos propios, optimizaciones internas o partes cubiertas por la PPA.

 1. Hash del documento (Client-side SHA-256)

El hash se calcula completamente en el navegador:

// client/src/utils/fileHashUtils.js
export async function calculateFileHash(file) {
  const arrayBuffer = await file.arrayBuffer();
  const uint8 = new Uint8Array(arrayBuffer);
  const hash = sha256(uint8);
  return bytesToHex(hash);
}


Nunca enviamos el archivo al servidor.

Solo transmitimos el hash SHA-256.

 2. Certificaci贸n del documento

Pseudo-c贸digo neutral (no patentable):

function certify(file):
    buffer = readLocal(file)
    hash = SHA256(buffer)
    timestamp = requestRFC3161(hash)
    blockchainRecord = anchorToPolygon(hash)
    auditPage = renderAuditTrail(hash, timestamp, blockchainRecord)
    pdf = appendAuditPage(file, auditPage)
    ecox = packageEvidence(hash, timestamp, blockchainRecord)
    return { pdf, ecox }


Compatibilidad con el repo:

// client/src/lib/basicCertificationWeb.js (fragmento)
const fileArray = new Uint8Array(fileBuffer);
const hash = calculateSHA256(fileArray);

 3. Timestamp legal (RFC 3161)

El servidor obtiene un sello RFC 3161:

POST /tsa/timestamp
Input: SHA256(file)
Output: DER-encoded timestamp token


Guardar en el manifest del .ECOX:

{
  "legalTimestamp": {
    "standard": "RFC 3161",
    "tsa": "ExampleTSA",
    "verified": true
  }
}

 4. Registro descentralizado (Polygon o Bitcoin)
Polygon (r谩pido, econ贸mico)

Pseudo-c贸digo:

tx = polygon.send({
    data: hash,
    to: smartContractAddress
})

Bitcoin (OpenTimestamps)
ots = opentimestamps.stamp(hash)

 5. Firma interna (EcoSign)

EcoSign no usa claves del servidor.
El usuario firma con:

firma dibujada,

firma tipeada, o

imagen cargada.

Luego se registra en Hoja de Auditor铆a:

{
  "signature": "base64png",
  "signedAt": "ISO-8601",
  "identity": {
    "name": "...",
    "email": "...",
    "company": "...",
    "role": "..."
  }
}

 6. Formato .ECOX (contenedor seguro)

Estructura conceptual:

/manifest.json
/signatures.json
/audit-trail.pdf
/timestamps/
   rfc3161.token
/blockchain/
   polygon.tx
   bitcoin.ots


Ejemplo real (extra铆do del repo):

// eco-packer/API.md
interface EcoManifest {
  signatures: Array<{
    keyId: string;
    signature: string;
    algorithm: 'Ed25519';
  }>;
  assetHashes: Map<string, string>;
}

 7. Hoja de Auditor铆a (PDF)

Generaci贸n:

// client/src/utils/pdfSignature.js (fragmento)
const auditPDF = await pdfLib.createPage({
  hash,
  signerName,
  timestamps,
  blockchainRecords,
});


La Hoja contiene:

nombre del firmante

hash del documento

timestamps

registros blockchain

QR de verificaci贸n

firma aut贸grafa (si aplica)
